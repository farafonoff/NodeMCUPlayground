<DOCTYPE HTML>
<html>
<head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>My control</title>
   </head>
<body>
<label>
<input type='checkbox' data-what='gpio' data-param='0' class='toggler'>
GPIO0 LED
</label>
<pre id='log'>
</pre>
<script type="text/javascript">
var api = '/api/';
function log(str) {
    //document.querySelector('#log').innerHTML+=str+'\r\n';
}
log('script');
function apicall(query) {
    var uri = api+query;
    log(uri);
    var xhr = new XMLHttpRequest();
    xhr.open('GET', uri, false);
    xhr.send();
}
function toggle(evt) {
    log('toggle');
    log(evt.target);
    var what = evt.target.getAttribute('data-what');
    var param = evt.target.getAttribute('data-param');
    apicall(what+'/'+param+':'+evt.target.checked);
}
var array = [].slice.call(document.querySelectorAll('.toggler'));
for(var i=0;i<array.length;++i) {
    log(i);
    var input = array[i];
    input.addEventListener('change', toggle);
}
log(array);
</script>
<div>bug fixed</div>
</body>
</html>
